<?xml version="1.0" encoding="utf-8"?>
<issues>
  <issue>
    <field name="Priority">
      <value>Major</value>
    </field>
    <field name="Type">
      <value>Bug</value>
    </field>
    <field name="State">
      <value>Fixed</value>
    </field>
    <field name="Assignee" />
    <field name="Subsystem">
      <value>Generator</value>
    </field>
    <field name="Fix versions" />
    <field name="Affected versions" />
    <field name="Fixed in build" />
    <field name="numberInProject">
      <value>165</value>
    </field>
    <field name="summary">
      <value>UniqueKey property on BelongsToAttributed does not cause generation of unique-key attribute in associated many-to-one xml element</value>
    </field>
    <field name="description">
      <value>Here is code that will cause this to happen:

using Castle.ActiveRecord;

namespace Test.ObjectModel {
    [ActiveRecord("TestPerson")]
    public class Person {
        private int _id;

        [PrimaryKey]
        public virtual int Id
        {
            get { return _id; }
            set { _id = value; }
        }
    }

    [ActiveRecord("TestAddress")]
    public class Address
    {
        private int _id;
        private Person _person;
        private string _addressType;

        [PrimaryKey]
        public virtual int Id
        {
            get { return _id; }
            set { _id = value; }
        }

        [BelongsTo("PersonId", UniqueKey = "PersonAddressType")]
        public virtual Person Person
        {
            get { return _person; }
            set { _person = value; }
        }

        [Property(UniqueKey = "PersonAddressType")]
        public string AddressType
        {
            get { return _addressType; }
            set { _addressType = value; }
        }
    }
}


Here is the XML that is generated by ActiveRecord:

&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;hibernate-mapping  auto-import="true" default-lazy="true" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:nhibernate-mapping-2.2"&gt;
  &lt;class name="HumanResources.ObjectModel.Address, HumanResources" table="TestAddress"&gt;
    &lt;id name="Id" access="property" column="Id" type="Int32" unsaved-value="0"&gt;
      &lt;generator class="native"&gt;
      &lt;/generator&gt;
    &lt;/id&gt;
    &lt;property name="AddressType" access="property" type="String"&gt;
      &lt;column name="AddressType" unique-key="PersonAddressType"/&gt;
    &lt;/property&gt;
    &lt;many-to-one name="Person" access="property" class="HumanResources.ObjectModel.Person, HumanResources" column="PersonId" /&gt;
  &lt;/class&gt;
&lt;/hibernate-mapping&gt;


Notice the line:     &lt;many-to-one name="Person" access="property" class="HumanResources.ObjectModel.Person, HumanResources" column="PersonId" /&gt; should include the attribute unique-key="PersonAddressType" but it does not.</value>
    </field>
    <field name="created">
      <value>1182943934000</value>
    </field>
    <field name="updated">
      <value>1186925031000</value>
    </field>
    <field name="reporterName">
      <value>mthomas</value>
    </field>
    <field name="updaterName">
      <value>mthomas</value>
    </field>
    <field name="resolved">
      <value>1282136432729</value>
    </field>
    <field name="permittedGroup">
      <value>All Users</value>
    </field>
  </issue>
</issues>